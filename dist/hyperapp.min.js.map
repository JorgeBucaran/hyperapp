{"version":3,"file":"hyperapp.min.js","sources":["../src/app.js","../src/h.js","../src/index.js"],"sourcesContent":["export default options => {\n\tconst defer = (fn, data) => {\n\t\tsetTimeout(_ => fn(data), 0)\n\t}\n\n\tconst merge = (a, b) => {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tconst isPrimitive = type => type === \"string\" || type === \"number\" || type === \"boolean\"\n\n\tconst render = (model, view, lastNode) => {\n\t\tpatch(root, node = view(model, msg), lastNode, 0)\n\t}\n\n\tconst shouldUpdate = (a, b) => a.tag !== b.tag || typeof a !== typeof b || isPrimitive(typeof a) && a !== b\n\n\tconst patch = (parent, node, oldNode, index) => {\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tif (index >= 0) {\n\t\t\t\tvar element = parent.childNodes[index]\n\n\t\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\t\tif (hook) {\n\t\t\t\t\t\tdefer(hook, element)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tparent.removeChild(element)\n\t\t\t}\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tparent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.tree.length, oldLen = oldNode.tree.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.tree[i], oldNode.tree[i], i)\n\t\t\t}\n\t\t}\n\t}\n\n\tconst createElementFrom = node => {\n\t\tvar element\n\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.tree.length; i++) {\n\t\t\t\telement.appendChild(createElementFrom(node.tree[i]))\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tconst setElementData = (element, name, value, oldValue) => {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name.substr(0, 2) === \"on\") {\n\t\t\tvar event = name.substr(2)\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\telement[name] = value\n\t\t\t}\n\t\t}\n\t}\n\n\tconst removeElementData = (element, name, value) => {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tconst updateElementData = (element, data, oldData) => {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name], oldValue = oldData[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (value !== oldValue) {\n\t\t\t\tname === \"onupdate\"\n\t\t\t\t\t? defer(value, element)\n\t\t\t\t\t: setElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tconst regexify = path => {\n\t\tvar keys = [], re = \"^\" + path\n\t\t\t.replace(/\\//g, \"\\\\/\")\n\t\t\t.replace(/:([A-Za-z0-9_]+)/g, (_, key) => {\n\t\t\t\tkeys.push(key)\n\t\t\t\treturn \"([A-Za-z0-9_]+)\"\n\t\t\t}) + \"/?$\"\n\n\t\treturn { re: re, keys: keys }\n\t}\n\n\tconst route = (routes, path) => {\n\t\tfor (var route in routes) {\n\t\t\tvar re = regexify(route), params = {}, match\n\n\t\t\tpath.replace(new RegExp(re.re, \"g\"), function() {\n\t\t\t\tfor (var i = 1; i < arguments.length - 2; i++) {\n\t\t\t\t\tparams[re.keys.shift()] = arguments[i]\n\t\t\t\t}\n\t\t\t\tmatch = (model, msg) => routes[route](model, msg, params)\n\t\t\t})\n\n\t\t\tif (match) {\n\t\t\t\treturn match\n\t\t\t}\n\t\t}\n\n\t\treturn routes[\"/\"]\n\t}\n\n\tvar msg = {}\n\n\tvar model = options.model\n\tvar reducers = options.update || {}\n\tvar effects = options.effects || {}\n\tvar subs = options.subs || {}\n\n\tvar hooks = merge({\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: err => {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tvar node\n\tvar root = options.root || document.body.appendChild(document.createElement(\"div\"))\n\tvar view = options.view || (_ => root)\n\tvar routes = typeof view === \"function\" ? undefined : view\n\n\tif (routes) {\n\t\tview = route(routes, location.pathname)\n\n\t\tmsg.setLocation = data => {\n\t\t\trender(model, view = route(routes, data), node)\n\t\t\thistory.pushState({}, \"\", data)\n\t\t}\n\n\t\twindow.addEventListener(\"popstate\", _ => {\n\t\t\trender(model, view = route(routes, location.pathname), node)\n\t\t})\n\n\t\twindow.addEventListener(\"click\", e => {\n\t\t\tif (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tvar target = e.target\n\n\t\t\twhile (target && target.localName !== \"a\") {\n\t\t\t\ttarget = target.parentNode\n\t\t\t}\n\n\t\t\tif (target && target.host === location.host\n\t\t\t\t&& !target.hasAttribute(\"data-no-routing\")) {\n\n\t\t\t\tvar element = target.hash === \"\" ? element : document.querySelector(target.hash)\n\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView(true)\n\t\t\t\t} else {\n\t\t\t\t\tmsg.setLocation(target.pathname)\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tfor (let name in merge(reducers, effects)) {\n\t\tmsg[name] = data => {\n\t\t\thooks.onAction(name, data)\n\n\t\t\tvar effect = effects[name]\n\t\t\tif (effect) {\n\t\t\t\treturn effect(model, msg, data, hooks.onError)\n\t\t\t}\n\n\t\t\tvar update = reducers[name], _model = model\n\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\thooks.onUpdate(_model, model, data)\n\t\t}\n\t}\n\n\tdocument.addEventListener(\"DOMContentLoaded\", _ => {\n\t\tfor (var sub in subs) {\n\t\t\tsubs[sub](model, msg, hooks.onError)\n\t\t}\n\t})\n\n\trender(model, view)\n}\n","const svg = (tag, data, tree) => {\n\tdata.ns = \"http://www.w3.org/2000/svg\"\n\n\ttree.forEach(node => {\n\t\tif (node.data) {\n\t\t\tsvg(node.tag, node.data, node.tree)\n\t\t}\n\t})\n}\n\nexport default (tag, data, tree) => {\n\tif (tag === \"svg\") {\n\t\tsvg(tag, data, tree)\n\t}\n\n\treturn {\n\t\ttag: tag,\n\t\tdata: data || {},\n\t\ttree: [].concat.apply([], tree)\n\t}\n}\n","import app from \"./app.js\"\nimport h from \"./h.js\"\n\nexport default { app, h }\n"],"names":["options","const","node","defer","fn","data","setTimeout","_","merge","a","b","key","obj","isPrimitive","Array","isArray","type","render","model","view","lastNode","patch","root","msg","shouldUpdate","tag","parent","oldNode","index","undefined","appendChild","createElementFrom","childNodes","element","hook","onremove","removeChild","replaceChild","updateElementData","len","tree","length","oldLen","i","document","createTextNode","ns","createElementNS","createElement","name","setElementData","value","oldValue","style","substr","event","removeEventListener","addEventListener","removeAttribute","setAttribute","removeElementData","oldData","regexify","path","keys","re","replace","push","route","routes","match","params","RegExp","arguments","shift","reducers","update","effects","subs","hooks","onAction","Function","prototype","onUpdate","onError","err","body","location","pathname","setLocation","history","pushState","window","e","metaKey","shiftKey","ctrlKey","altKey","target","localName","parentNode","host","hasAttribute","hash","querySelector","scrollIntoView","preventDefault","effect","_model","let","loop","sub","svg","forEach","concat","apply","app","h"],"mappings":"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"}